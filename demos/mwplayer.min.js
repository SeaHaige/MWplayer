!function(){let r=MapWe="undefined"==typeof MapWe?{}:MapWe,l=8680
let s=null
let a=null,c=0,t=(new Date).getTime(),n=t,d=0,p=(new Date).getTime(),e=0,u=[],o=0,i=0,h=0,f=[]
function y(){if(0!=c&&2!=c){for(let e=0;e<u.length;e++)s.send(u[e])
u=[]}}!function e(){let t=a,n="stun:localhost:8000",o=(null!=a&&(n="stun:"+a+":8000"),new RTCPeerConnection({iceServers:[{urls:n}]}))
function i(){null!=o&&o.close(),(o=null)==t&&null!=a&&e()}o.onicecandidate=function(n){if(null!=n.candidate){if(0<n.candidate.candidate.indexOf(" typ host ")){let e=n.candidate.candidate.split(" typ host ")[0]
0<(e=e.split(" ")[e.split(" ").length-2]).indexOf(".")&&4==e.split(".").length&&(a=e)}if(0<n.candidate.candidate.indexOf(" typ srflx ")){let e=n.candidate.candidate.split(" typ srflx ")[0]
var o=(n=e.split(" "))[n.length-2]
e=n[n.length-1]
let t=0
"111.30.32.82"==o&&(h=1),"111.30.32.82"==o&&e!=l&&(l=e,0!=c&&2!=c||(0==c&&(s.close(),s=null),t=1)),1==t&&(z(),c=0)}}else i()},o.createDataChannel(""),o.createOffer().then(function(e){o.setLocalDescription(e,function(){},function(){})}),setTimeout(function(){i()},500)}(),y(window.top.location.href)
let g=[],w=1,b=2,m=4,v=5,x="mwplayersetup.exe",T={x:window.screenX,y:window.screenY},C=["<span style='color:#ccc;position:absolute;top:calc(50% - 32px);                    left:0px;width:100%;text-align:center;font-size:12px;'>重连中...</span>","<span style='color:#ccc;position:absolute;top:calc(50% - 32px);            left:0px;width:100%;text-align:center;font-size:12px;'>失败,等待重试(%d)...</span>","<span style='position:absolute;top:calc(50% - 0px);text-align:center;left:0px;width:100%;'><button style='cursor:hand;'>取消</button></span>","<span style='color:#ccc;position:absolute;top:calc(50% - 32px);                    left:0px;width:100%;text-align:center;font-size:12px;'>播放结束...</span>","<span style='color:#ccc;position:absolute;top:0px;                left:0px;width:100%;height:100%;text-align:center;background-color:#000;'>                <span style='position:absolute;top:50%;left:0px;width:100%;transform: translateY(-50%);'>连接中...</span></span>","<font size=3 bold><b>控件未安装或加载失败！</b></font><br> <font size=1>若未安装成功，请下载安装控件</font><br><a href=''>请下载浏览器控件</a>"],L=[]
function M(e){function i(e){var t=g[e].playobj,n=(g[e].state=v,g[e].retrynum++,t.style.backgroundColor="#000",t.style.borderColor="#000",C[1].replace("%d",""+g[e].retrynum))
n+=C[2],t.innerHTML=n
let o=g[e].hd
t.querySelector("button").addEventListener("click",function(){r.close(o)})}function l(n,e){var o=g[n].playobj
if("fail"==e)if(g[n].retrynum<g[n].maxretry&&g[n].state!=m){i(n)
let e=g[n].hd
setTimeout(function(){var t=e
for(let e=0;e<g.length;e++)g[e].hd==t&&g[e].state==v&&(g[e].playobj.innerHTML=C[0],u.push("/retry/"+t),y())},1e3*g[n].retryinter)}else g[n].state=m,o.innerHTML=C[3]
if("open"==e&&(g[n].state=b,o.innerHTML=""),"find"==e){g[n].state=w
let t=g[n].hd
0!=g[n].timeout&&setTimeout(function(){for(let e=0;e<g.length;e++)g[e].state==w&&g[e].hd==t&&i(e)},1e3*g[n].timeout),o.style.backgroundColor="#fffdfc",o.innerHTML=C[4]}}e.onopen=function(e){o=1,c=1,y()
for(let t=0;t<f.length;t++){var n=r.play(f[t].url,f[t].div,f[t].option)
for(let e=0;e<L.length;e++)if(L[e].container==f[t].div){L[e].hd=n,L.splice(e,1)
break}}f=[]},e.onmessage=function(e){var t=e.data.substring(0,4)
if("find"==t||"open"==t||"fail"==t){var n=parseInt(e.data.split(":")[1])
for(let e=0;e<g.length;e++)if(g[e].hd==n){l(e,t)
break}}if("spbk"==t){let t=e.data.substring(5,40)
var o=(t=t.split("\n")[0]).length,e=(t=parseInt(t),e.data.substring(5+o+1)),o=new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(e){return parseInt(e,16)})),i=new Blob([o],{type:"image/jpeg"})
for(let e=0;e<g.length;e++)g[e].hd==t&&(g[e].snapcb(i),g[e].snapcb=null)}},e.onclose=function(e){console.log("closed"),c=2,t=(new Date).getTime()},e.onerror=function(e){console.log("err")}}function z(){try{M(s=new WebSocket("ws://localhost:"+l+"/"))}catch(e){}}(mwplayer=function(e){0==d&&(d=(new Date).getTime()),i||(i=1,z()),this.option={},void 0!==e&&(this.option=e.option,void 0!==e.download&&(x=e.download),void 0!==e.probesize&&(u.push("/probe/"+e.probesize),y()),this.url=e.video,this.container=e.container,void 0!==e.video&&void 0!==e.container&&(this.hd=r.play(e.video,e.container,e.option)),-2==this.hd)&&L.push(this)}).prototype.checkplugin=function(e){var t
1==c?e(!0):1800<(t=(new Date).getTime())-n?e(!1):setTimeout(function(){1==c?e(!0):e(!1)},1800-(t-n))},mwplayer.prototype.destroy=function(){for(let e=0;e<L.length;e++)if(L[e]==this){L.splice(e,1)
break}r.close(this.hd)},mwplayer.prototype.hide=function(){r.hide(this.hd)},mwplayer.prototype.show=function(){r.show(this.hd)},mwplayer.prototype.layout=function(){r.remap()},mwplayer.prototype.setHTMLTemplate=function(e,t){r.setHTMLTemplate(e,t)},mwplayer.prototype.snap=function(t){for(let e=0;e<g.length;e++)(g[e].hd=this.hd)&&(g[e].snapcb=t)
u.push("/snap/"+this.hd),y()},mwplayer.prototype.recordstart=function(){u.push("/recs/"+this.hd),y()},mwplayer.prototype.recordstop=function(){u.push("/rece/"+this.hd),y()},r.setHTMLTemplate=function(e,t){let n="retrying"==e?0:"fail"==e?1:"retry"==e?2:"end"==e?3:"connect"==e?4:-1
0<n&&(C[n]=t)},r.setdownloadurl=function(e){x=e},r.hide=function(t){void 0===t&&(t="")
for(let e=0;e<g.length;e++)g[e].hd==t&&(g[e].playobj.style.display="none")
u.push("/hide/"+t),y()},r.snap=function(t,n){for(let e=0;e<g.length;e++)g[e].hd==t&&(g[e].snapcb=n)
u.push("/snap/"+t),y()},r.remap=function(){let t=""
for(let e=0;e<g.length;e++){0<e&&(t+=",")
var n=g[e].playobj
t+=g[e].hd+"="+n.getBoundingClientRect().left+"="+n.getBoundingClientRect().top+"="+n.getBoundingClientRect().width+"="+n.getBoundingClientRect().height}u.push("/resize/"+t),y()},r.blur=function(e){void 0===e&&(e=""),u.push("/blur/"+e),y()},r.show=function(t){void 0===t&&(t="")
for(let e=0;e<g.length;e++)g[e].hd==t&&(g[e].playobj.style.display="")
u.push("/show/"+t),y()},r.close=function(t){u.push("/close/"+t),y()
for(let e=0;e<g.length;e++)if(g[e].hd==t){g[e].parobj.removeChild(g[e].playobj),g.splice(e,1)
break}},r.live=function(){if(0!=g.length){let t=""
for(let e=0;e<g.length;e++)0!=e&&(t+=","),t+=g[e].hd
u.push("/live/"+t),y()}},r.play=function(e,t,n){var o,i,l
return 1==c||h?((i=document.body.querySelector(t)).innerHTML="",(o=document.createElement("div")).style.position="relative",o.style.boxSizing="border-box",o.style.width="100%",o.style.height="100%",o.style.border="1px solid #4bd44b",o.style.backgroundColor="#fefdfc",i.appendChild(o),p=(new Date).getTime(),l=Math.floor(1e5*Math.random()),void 0===(n=void 0===n?{}:n).title&&(n.title=""),g.push({hd:l,playobj:o,parobj:i,state:0,retrynum:0,snapcb:null,maxretry:n.maxretry||1e4,timeout:n.timeout||0,retryinter:n.retryinter||60}),n.containerpos={l:o.getBoundingClientRect().left,t:o.getBoundingClientRect().top,w:o.getBoundingClientRect().width,h:o.getBoundingClientRect().height},u.push("/play/"+l+"/"+e+"\n"+JSON.stringify(n)),y(),l):(new Date).getTime()-d<1e3?(f.push({url:e,div:t,option:n}),-2):((i=document.body.querySelector(t)).innerHTML="",(o=document.createElement("div")).style.position="relative",o.style.boxSizing="border-box",o.style.width="100%",o.style.height="100%",o.style.textAlign="center",o.style.backgroundColor="#fefdfc",o.innerHTML=C[5],i.appendChild(o),o.querySelector("a").href=x,-1)},r.onresize=function(){r.remap()},window.addEventListener("focus",function(){r.show(),p=(new Date).getTime()}),window.addEventListener("resize",function(){r.onresize()}),window.addEventListener("blur",function(){20<(new Date).getTime()-p&&r.blur()}),document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState?r.hide():r.show()}),window.addEventListener("unload",function(e){for(let e=0;e<g.length;e++)u.push("/close/"+g[e].hd)
y()}),setInterval(function(){++e,T.x==window.screenX&&T.y==window.screenY||(T.x=window.screenX,T.y=window.screenY,r.onresize())},100)}()
