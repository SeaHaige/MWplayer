!function(){let r=MapWe="undefined"==typeof MapWe?{}:MapWe,l=8680
let s=null
let a=null,c=0,t=(new Date).getTime(),p=t,d=(new Date).getTime(),e=0,u=[],n=0,o=0,f=0
function h(){if(0!=c&&2!=c){for(let e=0;e<u.length;e++)s.send(u[e])
u=[]}}!function e(){let t=a,n="stun:localhost:8000",o=(null!=a&&(n="stun:"+a+":8000"),new RTCPeerConnection({iceServers:[{urls:n}]}))
function i(){null!=o&&o.close(),(o=null)==t&&null!=a&&e()}o.onicecandidate=function(n){if(null!=n.candidate){if(0<n.candidate.candidate.indexOf(" typ host ")){let e=n.candidate.candidate.split(" typ host ")[0]
0<(e=e.split(" ")[e.split(" ").length-2]).indexOf(".")&&4==e.split(".").length&&(a=e)}if(0<n.candidate.candidate.indexOf(" typ srflx ")){let e=n.candidate.candidate.split(" typ srflx ")[0]
var o=(n=e.split(" "))[n.length-2]
e=n[n.length-1]
let t=0
"111.30.32.82"==o&&(f=1),"111.30.32.82"==o&&e!=l&&(l=e,0!=c&&2!=c||(0==c&&(s.close(),s=null),t=1)),1==t&&(L(),c=0)}}else i()},o.createDataChannel(""),o.createOffer().then(function(e){o.setLocalDescription(e,function(){},function(){})}),setTimeout(function(){i()},500)}(),h(window.top.location.href)
let y=[],w=1,b=2,g=4,m=5,v="mwplayersetup.exe",i={x:window.screenX,y:window.screenY},x=["<span style='color:#ccc;position:absolute;top:calc(50% - 32px);                    left:0px;width:100%;text-align:center;font-size:12px;'>重连中...</span>","<span style='color:#ccc;position:absolute;top:calc(50% - 32px);            left:0px;width:100%;text-align:center;font-size:12px;'>失败,等待重试(%d)...</span>","<span style='position:absolute;top:calc(50% - 0px);text-align:center;left:0px;width:100%;'><button style='cursor:hand;'>取消</button></span>","<span style='color:#ccc;position:absolute;top:calc(50% - 32px);                    left:0px;width:100%;text-align:center;font-size:12px;'>播放结束...</span>","<span style='color:#ccc;position:absolute;top:0px;                left:0px;width:100%;height:100%;text-align:center;background-color:#000;'>                <span style='position:absolute;top:50%;left:0px;width:100%;transform: translateY(-50%);'>连接中...</span></span>"]
function T(e){function i(e){var t=y[e].playobj,n=(y[e].state=m,y[e].retrynum++,t.style.backgroundColor="#000",t.style.borderColor="#000",x[1].replace("%d",""+y[e].retrynum))
n+=x[2],t.innerHTML=n
let o=y[e].hd
t.querySelector("button").addEventListener("click",function(){console.log("close now :",o),r.close(o)})}function l(n,e){var o=y[n].playobj
if("fail"==e)if(y[n].retrynum<y[n].maxretry&&y[n].state!=g){i(n)
let e=y[n].hd
setTimeout(function(){var t=e
for(let e=0;e<y.length;e++)y[e].hd==t&&y[e].state==m&&(y[e].playobj.innerHTML=x[0],u.push("/retry/"+t),h())},1e3*y[n].retryinter)}else y[n].state=g,o.innerHTML=x[3]
if("open"==e&&(y[n].state=b,o.innerHTML=""),"find"==e){y[n].state=w
let t=y[n].hd
0!=y[n].timeout&&setTimeout(function(){for(let e=0;e<y.length;e++)y[e].state==w&&y[e].hd==t&&i(e)},1e3*y[n].timeout),o.style.backgroundColor="#fffdfc",o.innerHTML=x[4]}}e.onopen=function(e){n=1,c=1,h()},e.onmessage=function(e){var t=e.data.substring(0,4)
if("find"==t||"open"==t||"fail"==t){var n=parseInt(e.data.split(":")[1])
for(let e=0;e<y.length;e++)if(y[e].hd==n){l(e,t)
break}}if("spbk"==t){let t=e.data.substring(5,40)
var o=(t=t.split("\n")[0]).length,e=(t=parseInt(t),e.data.substring(5+o+1)),o=new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(e){return parseInt(e,16)})),i=new Blob([o],{type:"image/jpeg"})
for(let e=0;e<y.length;e++)y[e].hd==t&&(y[e].snapcb(i),y[e].snapcb=null)}},e.onclose=function(e){console.log("closed"),c=2,t=(new Date).getTime()},e.onerror=function(e){console.log("err")}}function L(){try{T(s=new WebSocket("ws://localhost:"+l+"/"))}catch(e){}}(mwplayer=function(e){o||(o=1,L()),this.option={},void 0!==e&&(this.option=e.option,void 0!==e.download&&(v=e.download),this.url=e.video,void 0!==e.video)&&void 0!==e.container&&(this.hd=r.play(e.video,e.container,e.option))}).prototype.checkplugin=function(e){var t
1==c?e(!0):1800<(t=(new Date).getTime())-p?e(!1):setTimeout(function(){1==c?e(!0):e(!1)},1800-(t-p))},mwplayer.prototype.destroy=function(){r.close(this.hd)},mwplayer.prototype.hide=function(){r.hide(this.hd)},mwplayer.prototype.show=function(){r.show(this.hd)},mwplayer.prototype.layout=function(){r.remap()},mwplayer.prototype.setHTMLTemplate=function(e,t){r.setHTMLTemplate(e,t)},mwplayer.prototype.snap=function(t){for(let e=0;e<y.length;e++)(y[e].hd=this.hd)&&(y[e].snapcb=t)
u.push("/snap/"+this.hd),h()},mwplayer.prototype.recordstart=function(){u.push("/recs/"+this.hd),h()},mwplayer.prototype.recordstop=function(){u.push("/rece/"+this.hd),h()},r.setHTMLTemplate=function(e,t){let n="retrying"==e?0:"fail"==e?1:"retry"==e?2:"end"==e?3:"connect"==e?4:-1
0<n&&(x[n]=t)},r.setdownloadurl=function(e){v=e},r.hide=function(t){void 0===t&&(t="")
for(let e=0;e<y.length;e++)y[e].hd==t&&(y[e].playobj.style.display="none")
u.push("/hide/"+t),h()},r.snap=function(t,n){for(let e=0;e<y.length;e++)y[e].hd==t&&(y[e].snapcb=n)
u.push("/snap/"+t),h()},r.remap=function(){let t=""
for(let e=0;e<y.length;e++){0<e&&(t+=",")
var n=y[e].playobj
t+=y[e].hd+"="+n.offsetLeft+"="+n.offsetTop+"="+n.offsetWidth+"="+n.offsetHeight}u.push("/resize/"+t),h()},r.blur=function(e){void 0===e&&(e=""),u.push("/blur/"+e),h()},r.show=function(t){void 0===t&&(t="")
for(let e=0;e<y.length;e++)y[e].hd==t&&(y[e].playobj.style.display="")
u.push("/show/"+t),h()},r.close=function(t){u.push("/close/"+t),h()
for(let e=0;e<y.length;e++)if(y[e].hd==t){y[e].parobj.removeChild(y[e].playobj),y.splice(e,1)
break}},r.live=function(){if(0!=y.length){let t=""
for(let e=0;e<y.length;e++)0!=e&&(t+=","),t+=y[e].hd
u.push("/live/"+t),h()}},r.play=function(e,t,n){var o,i,l
return 1==c||f?((i=document.body.querySelector(t)).innerHTML="",(o=document.createElement("div")).style.position="relative",o.style.boxSizing="border-box",o.style.width="100%",o.style.height="100%",o.style.border="1px solid #4bd44b",o.style.backgroundColor="#fefdfc",i.appendChild(o),d=(new Date).getTime(),l=Math.floor(1e5*Math.random()),y.push({hd:l,playobj:o,parobj:i,state:0,retrynum:0,snapcb:null,maxretry:n.maxretry||1e4,timeout:n.timeout||0,retryinter:n.retryinter||60}),void 0!==n&&u.push("/option/"+l+"/"+JSON.stringify(n)),u.push("/play/"+l+"/"+e),h(),l):(new Date).getTime()-p<1e3?void setTimeout(function(){r.play(e,t,n)},1600):((i=document.body.querySelector(t)).innerHTML="",(o=document.createElement("div")).style.position="relative",o.style.boxSizing="border-box",o.style.width="100%",o.style.height="100%",o.style.textAlign="center",o.style.backgroundColor="#fefdfc",o.innerHTML="<font size=3 bold><b>控件未安装或加载失败！</b></font><br> <font size=1>若未安装成功，请下载安装控件</font><br><a href='"+v+"'>请下载浏览器控件</a>",void i.appendChild(o))},r.onresize=function(){r.remap()},window.addEventListener("focus",function(){r.show(),d=(new Date).getTime()}),window.addEventListener("resize",function(){r.onresize()}),window.addEventListener("blur",function(){20<(new Date).getTime()-d&&r.blur()}),document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState?r.hide():r.show()}),window.addEventListener("unload",function(e){for(let e=0;e<y.length;e++)u.push("/close/"+y[e].hd)
h()}),setInterval(function(){0==++e%150&&r.live(),i.x==window.screenX&&i.y==window.screenY||(i.x=window.screenX,i.y=window.screenY,r.onresize())},100)}()
